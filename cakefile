require 'flour'
path = require 'path'
{exec} = require 'child_process'
spanner = require './spanner'

# Constants
COFFEE = 'coffee'
DOCGEN = 'codo'
MINIFIER = 'uglifyjs'

SOURCE = 'src'
OUTPUT = 'js'
STYL_SOURCE = 'stylus'
STYL_OUTPUT = 'css'

DOCOUTPUT = './doc'

task 'build:coffee', ->
  spanner.getFilesRecursively SOURCE, (fileArray) ->
    for i in fileArray
      ((file) ->
        destFile = relName.replace "#{SOURCE}", "#{OUTPUT}"
        destFile = destFile.split('.')[0] + '.js'

        console.log file
        console.log destFile

        compile file, destFile
      )(i.relName)

task 'build:stylus', ->
  compile "#{STYL_SOURCE}/*.styl", "#{STYL_OUTPUT}/*.css"

task 'build', ->
  invoke 'clean'
  invoke 'doc'

task 'doc', ->
  exec "#{DOCGEN} -o #{DOCOUTPUT} ${SOURCE}/*/*.coffee"

task 'clean', ->
  exec "rm -rf #{OUTPUT}/*.js"